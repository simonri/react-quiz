<!DOCTYPE html>
<html>
	<head>
		<%- include("partials/head") %>
		<script src="https://www.google.com/recaptcha/api.js?render=6LdSDOIUAAAAAI-H-zq0s-JyPU8dPa0QnA8Ufzb9"></script>
	</head>

	<body>
		<%- include("partials/navbar") %>

		<div class="container">
			<a class="form-logo with-top-margin" href=""> </a>
			<div class="row">
				<div class="col-sm-6 col-sm-offset-3">
					<div class="panel panel-default">
						<div class="panel-body">
							<span class="premium-marketing">
								<h2 class="text-center">7-Day Free Trial</h2>
								<p class="text-center">Try every feature. Cancel at any time.</p>
							</span>
							<form id="register_form" class="validate validate-cc validate-email" method="POST" action="/auth/register" autocomplete="on" spellcheck="false" novalidate="novalidate">
								<div class="form-group">
									<label id="nameLabel" for="name">Name</label>
									<input autocomplete="name" autocorrect="off" autofocus="" class="form-control" id="name" name="name" placeholder="First and last name" required="" size="50" type="text" value="" aria-required="true" />
								</div>
								<div class="form-group">
									<label id="emailLabel" for="email">Email</label>
									<input autocomplete="username email" autocorrect="off" class="form-control" id="email" name="email" placeholder="Your email address" required="" size="50" type="email" value="" aria-required="true" />
								</div>
								<div class="form-group">
									<label id="passwordLabel" for="password">Password</label>
									<input autocomplete="new-password" class="form-control" id="password" maxlength="250" minlength="8" name="password" placeholder="At least 8 characters" required="" size="50" type="password" value="" aria-required="true" />
								</div>

								<fieldset class="cc-fields bg-warning">
									<div class="radio">
										<label class="radio-inline">
											<div class="radio-label">
												Annual
											</div>
											<input type="radio" name="paymentDuration" value="29_annually" checked="checked" />
											$129 / month
											<span class="help-block">
												Billed as $1548/ year
											</span>
										</label>
										<label class="radio-inline">
											<div class="radio-label">
												Monthly
											</div>
											<input type="radio" name="paymentDuration" value="monthly_35" />
											$159/ month
											<span class="help-block">
												Month-to-month
											</span>
										</label>
										<p class="text-muted">
											You will not be charged until the end of your 7-day trial. You can cancel at any time.
										</p>
									</div>
									<div class="row">
										<div class="col-md-10 col-sm-8">
											<div class="form-group">
												<label for="cc_number">Card number</label>
												<input type="tel" id="cc-number" class="form-control cc-field" placeholder="•••• •••• •••• ••••" autocomplete="cc_number" />
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-md-3 col-sm-4">
											<div class="form-group">
												<label for="cc-expiration">Expiration</label>
												<input type="tel" id="cc-expiration" class="form-control cc-field" placeholder="MM / YY" autocomplete="cc-exp" />
											</div>
										</div>
										<div class="col-md-3 col-sm-4">
											<div class="form-group">
												<label for="cc-cvc">Security code</label>
												<input type="tel" id="cc-cvc" class="form-control cc-field" maxlength="4" autocomplete="cc-csc" />
											</div>
										</div>
										<div class="col-md-4 col-sm-8">
											<div class="form-group">
												<label for="cc-postal-code">Zip/Postal Code</label>
												<input type="tel" id="cc-postal-code" class="form-control cc-field" autocomplete="billing postal-code" />
											</div>
										</div>
									</div>
								</fieldset>

								<button class="btn btn-lg btn-success" type="submit">Get Started</button>
							</form>
						</div>
					</div>
					<p class="text-muted">Signing uppppp signifies that you have read and agree to our <a href="terms">Terms of Service</a> and <a href="privacy">Privacy Policy</a>.</p>
				</div>
			</div>
		</div>

		<%- include("partials/footer") %>

		<script>
			grecaptcha.ready(() => {
				grecaptcha.execute("6LdSDOIUAAAAAI-H-zq0s-JyPU8dPa0QnA8Ufzb9", {action: "register"}).then(token => {
					$("#register_form").submit(e => {
						const {name, email, password} = $(this)
							.find("#name, #email, #password")
							.serializeArray()
							.reduce((obj, current) => {
								obj[current.name] = current.value;
								return obj;
							}, {});

						$.ajax({
							type: "POST",
							url: "/identity/auth/register",
							data: JSON.stringify({
								name,
								email,
								password,
								token
							}),
							success: data => {
								console.log(data);
							},
							error: (xhr, ajaxOptions, thrownError) => {
								console.log(xhr.responseText);

								JSON.parse(xhr.responseText)
									.errors.map(item => item.split('"')[1])
									.forEach(item => {
										console.log(item);
										$(`#${item}Label`).css("color", "red");
									});
							},
							contentType: "application/json",
							dataType: "json"
						});
						return false;
					});
				});
			});
		</script>
	</body>
</html>
